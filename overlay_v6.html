<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PMV Karting OVERLAY v5</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Rajdhani:wght@400;600;700&family=Barlow+Condensed:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;width:100%;height:100%;background:transparent;overflow:hidden;}
#canvas{position:fixed;top:0;left:0;width:1920px;height:1080px;transform-origin:top left;overflow:hidden;background:transparent;}

@keyframes slideInLeft{from{opacity:0;transform:translateX(-60px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes rowIn{from{opacity:0;transform:translateX(18px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.25}}
@keyframes tickerAnim{from{transform:translateX(1920px)}to{transform:translateX(-100%)}}
@keyframes toastAnim{0%{opacity:0;transform:translateX(60px)}15%,80%{opacity:1;transform:translateX(0)}100%{opacity:0;transform:translateX(60px)}}
@keyframes gridSlideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes introSweep{from{clip-path:polygon(0 0,0 0,0 100%,0 100%)}to{clip-path:polygon(0 0,100% 0,100% 100%,0 100%)}}
@keyframes introLineSweep{from{width:0}to{width:100%}}
@keyframes introFadeUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
@keyframes introBadge{from{opacity:0;transform:scale(0.85)}to{opacity:1;transform:scale(1)}}
@keyframes introDataRow{from{opacity:0;transform:translateX(-18px)}to{opacity:1;transform:translateX(0)}}
@keyframes scanLine{from{top:0}to{top:100%}}

:root{
  --c1:#dc143c;--c2:#8b0000;--c3:#5a0000;
  --bg:rgba(0,0,0,0.88);--bg2:rgba(0,0,0,0.75);
  --txt:#fff;--txt2:#ccc;--txt3:#777;
  --accent:#00ff88;--font:'Montserrat',sans-serif;--skew:-8deg;
  /* opacidades esquina */
  --op-bug:0.88;--op-torre:0.88;--op-timer:0.92;--op-bar:0.88;
  /* opacidades centro */
  --op-intro:0.97;--op-parrilla:0.97;--op-fullgfx:0.97;--op-podio:0.96;--op-mensaje:0.93;--op-batalla:0.88;
}

/* ‚îÄ‚îÄ‚îÄ BUG ‚îÄ‚îÄ‚îÄ */
#bug{position:absolute;top:28px;left:28px;background:rgba(0,0,0,var(--op-bug));border-left:4px solid var(--c1);padding:12px 18px;min-width:200px;transition:opacity 0.4s;font-family:var(--font);}
#bug-evento{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--c1);font-weight:700;}
#bug-tipo{font-size:22px;font-weight:900;letter-spacing:1px;margin-top:2px;color:var(--txt);}
#bug-info{font-size:11px;color:var(--txt3);margin-top:3px;}

/* ‚îÄ‚îÄ‚îÄ SESION BAR ‚îÄ‚îÄ‚îÄ */
#sesion-bar{position:absolute;top:28px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,var(--op-bar));padding:10px 28px;display:flex;gap:18px;align-items:center;font-size:12px;letter-spacing:1px;text-transform:uppercase;white-space:nowrap;transition:opacity 0.4s;font-family:var(--font);}
#sesion-bar strong{color:var(--txt);font-weight:700;}
.bsep{color:var(--c1);}

/* ‚îÄ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ‚îÄ */
#timer-area{position:absolute;top:28px;right:28px;display:flex;gap:0;align-items:stretch;transition:opacity 0.4s;font-family:var(--font);}
#timer-vueltas{background:linear-gradient(135deg,var(--c3),var(--c2),var(--c1));padding:10px 22px;display:flex;gap:6px;align-items:baseline;transform:skewX(var(--skew));opacity:var(--op-timer);}
#t-vuelta-label{font-size:11px;letter-spacing:3px;text-transform:uppercase;opacity:0.75;color:var(--txt);}
#t-vuelta-num{font-size:44px;font-weight:900;line-height:1;color:var(--txt);}
#t-vuelta-sep{font-size:24px;opacity:0.4;color:var(--txt);}
#t-vuelta-total{font-size:22px;font-weight:700;opacity:0.7;color:var(--txt);}
#timer-cron{background:rgba(0,20,60,var(--op-timer));border-left:3px solid #4488ff;padding:10px 22px;display:none;align-items:center;transform:skewX(var(--skew));}
#t-cron-time{font-size:36px;font-weight:900;color:#88ccff;line-height:1;letter-spacing:2px;}

/* ‚îÄ‚îÄ‚îÄ TORRE ‚îÄ‚îÄ‚îÄ */
#torre{position:absolute;left:24px;top:108px;width:390px;background:rgba(0,0,0,var(--op-torre));border-left:4px solid var(--c1);transition:opacity 0.5s;font-family:var(--font);}
#torre-header{background:linear-gradient(90deg,var(--c2),var(--c1));padding:8px 14px;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;display:flex;justify-content:space-between;color:var(--txt);}
.torre-row{display:grid;grid-template-columns:32px 44px 34px 1fr 82px;padding:7px 14px;border-bottom:1px solid #1c1c1c;align-items:center;animation:rowIn 0.3s ease both;font-family:var(--font);}
.torre-row:last-child{border:none;}
.t-pos{font-weight:900;font-size:17px;color:var(--c1);}
.t-num{font-weight:700;font-size:14px;color:var(--txt);}
.t-foto{width:28px;height:28px;border-radius:3px;object-fit:cover;border:1px solid #333;}
.t-info{overflow:hidden;}
.t-nombre{font-size:13px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;color:var(--txt);}
.t-equipo{font-size:10px;color:var(--txt3);margin-top:1px;}
.t-right{text-align:right;}
.t-gap{font-size:12px;color:var(--accent);font-weight:700;}
.t-vuelta{font-size:10px;color:#444;}
.row-p1{background:rgba(220,20,60,0.07);}
.row-p2 .t-pos{color:#b8b8b8;}
.row-p3 .t-pos{color:#b07030;}
.e-pit{color:#ffaa00!important;}
.e-out,.e-dnf{color:#ff4444!important;}

/* ‚îÄ‚îÄ‚îÄ LOWER THIRD ‚îÄ‚îÄ‚îÄ */
#lower-third{position:absolute;bottom:56px;left:0;opacity:0;transition:opacity 0.45s;font-family:var(--font);}
#lt-inner{background:linear-gradient(90deg,rgba(0,0,0,0.94) 55%,transparent);padding:20px 60px 20px 36px;border-left:6px solid var(--c1);}
#lt-badge{display:inline-block;background:var(--c2);padding:3px 12px;font-size:9px;letter-spacing:2px;text-transform:uppercase;font-weight:700;margin-bottom:8px;color:var(--txt);}
#lt-nombre{font-size:54px;font-weight:900;letter-spacing:1px;line-height:1;animation:slideInLeft 0.4s ease both;color:var(--txt);}
#lt-sub{font-size:26px;color:var(--txt2);margin-top:6px;animation:slideInLeft 0.5s ease both;}

/* ‚îÄ‚îÄ‚îÄ BANDERAS ‚îÄ‚îÄ‚îÄ */
#bandera-overlay{position:absolute;top:0;left:0;right:0;opacity:0;transition:opacity 0.3s;pointer-events:none;}
#bandera-inner{width:100%;padding:20px 0;text-align:center;font-size:38px;font-weight:900;letter-spacing:4px;text-transform:uppercase;font-family:var(--font);}
.fc-verde{background:rgba(0,110,0,0.93);}
.fc-amarilla{background:rgba(180,130,0,0.93);color:#000;}
.fc-fciy{background:rgba(190,110,0,0.93);color:#000;animation:pulse 0.8s infinite;}
.fc-roja{background:rgba(170,0,0,0.95);animation:pulse 0.55s infinite;}
.fc-safety{background:rgba(0,70,160,0.93);}
.fc-chequered{background:rgba(15,15,15,0.94);}

/* ‚îÄ‚îÄ‚îÄ MENSAJE ‚îÄ‚îÄ‚îÄ */
#mensaje-box{
  position:absolute;top:108px;left:50%;transform:translateX(-50%);
  max-width:1300px;padding:18px 50px;font-size:34px;font-weight:700;
  letter-spacing:1px;text-align:center;opacity:0;transition:opacity 0.4s;
  white-space:nowrap;font-family:var(--font);
  /* opacidad din√°mica aplicada inline via JS */
}
.mc-info{background:rgba(0,50,160,var(--op-mensaje));}
.mc-warning{background:rgba(160,110,0,var(--op-mensaje));color:#000;}
.mc-penalty{background:rgba(150,0,0,var(--op-mensaje));}
.mc-safety{background:rgba(0,55,150,var(--op-mensaje));}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FULL GRAPHIC (Parrilla, Tablas, etc.)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#full-graphic{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  width:1680px;max-height:900px;
  background:rgba(4,4,4,var(--op-parrilla));
  opacity:0;transition:opacity 0.5s;overflow:hidden;font-family:var(--font);
}
#fg-header{background:linear-gradient(90deg,#0d0000,var(--c2),var(--c1),var(--c2),#0d0000);padding:18px 50px;display:flex;justify-content:space-between;align-items:center;color:var(--txt);}
#fg-title{font-size:32px;font-weight:900;letter-spacing:4px;text-transform:uppercase;}
#fg-sub{font-size:12px;font-weight:400;letter-spacing:2px;opacity:0.6;}
#fg-body{padding:0;overflow-y:auto;max-height:800px;}
.fg-table{width:100%;border-collapse:collapse;font-size:19px;}
.fg-table th{background:#111;padding:11px 15px;text-align:left;font-size:11px;letter-spacing:2px;color:#555;text-transform:uppercase;border-bottom:2px solid #2a2a2a;}
.fg-table td{padding:11px 15px;border-bottom:1px solid #1a1a1a;vertical-align:middle;color:var(--txt);}
.fg-table tr:nth-child(1) td{background:rgba(139,0,0,0.13);font-weight:900;font-size:21px;}
.fg-table tr:nth-child(2) td{font-weight:700;}
.fg-pos{font-weight:900;color:var(--c1);}
.fg-num{font-weight:700;}
.fg-gap{color:var(--accent);font-size:15px;}
.fg-pts{font-weight:900;color:var(--c1);}
.fg-foto{width:44px;height:44px;border-radius:4px;object-fit:cover;border:1px solid #333;}
.fg-pais{font-size:20px;}

/* ‚îÄ‚îÄ‚îÄ PARRILLA F1 ‚îÄ‚îÄ‚îÄ */
#grid-f1-wrap{padding:22px 40px 16px;}
.grid-f1-title{font-size:10px;letter-spacing:3px;text-transform:uppercase;color:#444;font-weight:700;margin-bottom:14px;text-align:center;}
.grid-f1-track{display:grid;grid-template-columns:1fr 1fr;gap:0 60px;position:relative;}
.grid-f1-track::before{content:'';position:absolute;left:50%;transform:translateX(-50%);top:0;bottom:0;width:3px;background:linear-gradient(to bottom,transparent,var(--c2),transparent);}
.grid-slot{display:flex;align-items:center;gap:0;margin-bottom:9px;animation:gridSlideIn 0.35s ease both;}
.grid-slot.right-side{flex-direction:row-reverse;}
.gs-pos-block{min-width:54px;height:60px;background:linear-gradient(135deg,var(--c3),var(--c2),var(--c1));display:flex;flex-direction:column;align-items:center;justify-content:center;clip-path:polygon(0 0,94% 0,100% 100%,6% 100%);padding:0 10px;flex-shrink:0;z-index:2;}
.right-side .gs-pos-block{clip-path:polygon(6% 0,100% 0,94% 100%,0 100%);}
.gs-pos-num{font-size:26px;font-weight:900;color:#fff;line-height:1;}
.gs-pos-lbl{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.55);margin-top:1px;}
.gs-body{background:rgba(22,22,22,0.97);border:1px solid #282828;border-left:none;height:60px;flex:1;display:flex;align-items:center;padding:0 12px 0 10px;gap:9px;clip-path:polygon(0 0,97% 0,100% 100%,3% 100%);}
.right-side .gs-body{border-left:1px solid #282828;border-right:none;padding:0 10px 0 12px;clip-path:polygon(3% 0,100% 0,97% 100%,0 100%);}
.gs-foto{width:40px;height:40px;border-radius:3px;object-fit:cover;border:1px solid #333;flex-shrink:0;}
.gs-foto-placeholder{width:40px;height:40px;border-radius:3px;background:#1a1a1a;border:1px solid #222;flex-shrink:0;}
.gs-info{flex:1;overflow:hidden;}
.gs-nombre{font-size:14px;font-weight:900;text-transform:uppercase;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.gs-equipo{font-size:10px;color:#555;margin-top:2px;}
.gs-pais{font-size:14px;}
.gs-num-badge{background:var(--c1);color:#fff;font-size:11px;font-weight:900;padding:3px 7px;border-radius:3px;flex-shrink:0;}
.gs-quali{text-align:right;flex-shrink:0;}
.gs-quali-time{font-size:12px;font-weight:700;color:var(--accent);}
.gs-quali-lbl{font-size:8px;color:#444;letter-spacing:1px;text-transform:uppercase;}
.gs-p1 .gs-body{border-color:rgba(220,20,60,0.25);background:rgba(30,5,5,0.98);}
.gs-p1 .gs-nombre{color:var(--c1);}

/* ‚ïê‚ïê PANTALLA INTRO ‚ïê‚ïê */
#intro-screen{
  position:absolute;top:0;left:0;width:1920px;height:1080px;
  opacity:0;transition:opacity 0.6s;pointer-events:none;overflow:hidden;
  font-family:var(--font);
}
#intro-bg{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(5,5,5,var(--op-intro));}
#intro-track-img{position:absolute;right:0;top:0;width:860px;height:100%;object-fit:cover;object-position:center;opacity:0.35;mask-image:linear-gradient(to left,rgba(0,0,0,0.9) 40%,transparent 100%);-webkit-mask-image:linear-gradient(to left,rgba(0,0,0,0.9) 40%,transparent 100%);transition:opacity 0.8s 0.3s;}
#intro-hexbg{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.025;pointer-events:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='69'%3E%3Cpolygon points='30,1 59,16 59,52 30,68 1,52 1,16' fill='none' stroke='%23fff' stroke-width='1'/%3E%3C/svg%3E");background-size:60px 69px;}
#intro-scanline{position:absolute;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--c1),transparent);animation:scanLine 3s linear infinite;opacity:0.4;}
#intro-left{position:absolute;left:0;top:0;bottom:0;width:860px;display:flex;flex-direction:column;justify-content:center;padding:0 70px 0 60px;}
#intro-badge{display:inline-flex;align-items:center;gap:10px;background:var(--c1);padding:7px 20px;font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;margin-bottom:24px;animation:introBadge 0.5s ease 0.3s both;align-self:flex-start;}
#intro-evento{font-size:56px;font-weight:900;letter-spacing:2px;text-transform:uppercase;line-height:1;color:#fff;animation:introFadeUp 0.6s ease 0.5s both;white-space:pre-line;}
#intro-subtitulo{font-size:28px;font-weight:400;color:var(--c1);margin-top:8px;letter-spacing:1px;animation:introFadeUp 0.6s ease 0.65s both;}
#intro-line{height:3px;background:linear-gradient(90deg,var(--c1),var(--c2),transparent);margin:24px 0;animation:introLineSweep 0.8s ease 0.8s both;width:0;}
#intro-datos{display:grid;grid-template-columns:1fr 1fr;gap:14px 30px;animation:introFadeUp 0.5s ease 1s both;}
.intro-dato{display:flex;flex-direction:column;border-left:3px solid var(--c2);padding-left:12px;animation:introDataRow 0.4s ease both;}
.intro-dato-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--txt3);margin-bottom:3px;}
.intro-dato-val{font-size:19px;font-weight:700;color:#fff;}
.intro-dato-val .highlight{color:var(--c1);font-weight:900;}
#intro-ronda{display:inline-flex;align-items:center;gap:8px;margin-top:26px;animation:introFadeUp 0.5s ease 1.2s both;}
.intro-ronda-num{font-size:48px;font-weight:900;color:var(--c1);line-height:1;}
.intro-ronda-lbl{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--txt3);}
#intro-right{position:absolute;right:60px;bottom:60px;display:flex;flex-direction:column;align-items:flex-end;gap:12px;animation:introFadeUp 0.5s ease 1.4s both;}
.intro-stat-pill{background:rgba(0,0,0,0.75);border:1px solid #2a2a2a;border-right:3px solid var(--c1);padding:8px 20px;text-align:right;min-width:220px;}
.intro-stat-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--txt3);}
.intro-stat-val{font-size:22px;font-weight:900;color:#fff;margin-top:2px;}
#intro-logo{position:absolute;right:60px;top:48px;font-size:13px;font-weight:900;letter-spacing:4px;text-transform:uppercase;color:#fff;opacity:0.5;}
#intro-footer{position:absolute;bottom:0;left:0;right:0;height:48px;background:linear-gradient(90deg,var(--c3),var(--c2),var(--c1),var(--c2),var(--c3));display:flex;align-items:center;padding:0 60px;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;gap:30px;color:rgba(255,255,255,0.7);}

/* ‚ïê‚ïê PODIO ‚ïê‚ïê */
#podio-overlay{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,var(--op-podio));
  opacity:0;transition:opacity 0.5s;pointer-events:none;font-family:var(--font);
}
#podio-header{background:linear-gradient(90deg,#1a0000,var(--c2),var(--c1));padding:22px 60px;font-size:40px;font-weight:900;letter-spacing:3px;text-align:center;color:var(--txt);}
#podio-grid{display:grid;grid-template-columns:1fr 1.25fr 1fr;gap:24px;padding:40px 80px;align-items:end;}
.podio-card{background:rgba(18,18,18,0.9);text-align:center;padding:30px 20px;border-top:5px solid #333;animation:slideInUp 0.5s ease both;}
.podio-card.p1{border-color:#FFD700;padding-top:54px;}
.podio-card.p2{border-color:#C0C0C0;animation-delay:0.1s;}
.podio-card.p3{border-color:#CD7F32;animation-delay:0.2s;}
.podio-foto{width:80px;height:80px;border-radius:50%;object-fit:cover;margin:0 auto 14px;border:3px solid #333;display:block;}
.podio-card.p1 .podio-foto{border-color:#FFD700;width:96px;height:96px;}
.podio-num-pos{font-size:64px;font-weight:900;line-height:1;}
.podio-nombre{font-size:26px;font-weight:900;margin-top:8px;color:var(--txt);}
.podio-equipo{font-size:14px;color:var(--txt3);margin-top:4px;}
.podio-tiempo{font-size:17px;color:var(--accent);margin-top:6px;}

/* ‚ïê‚ïê BATALLA ‚ïê‚ïê */
#batalla-box{
  position:absolute;bottom:205px;left:50%;transform:translateX(-50%);
  width:720px;background:rgba(0,0,0,var(--op-batalla));
  border:1px solid #2a2a2a;opacity:0;transition:opacity 0.4s;font-family:var(--font);
}
#batalla-header{background:linear-gradient(90deg,#1a0000,var(--c2));padding:7px 20px;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--txt);}
#batalla-content{display:grid;grid-template-columns:1fr 90px 1fr;}
.bat-a{padding:16px 20px;font-size:18px;font-weight:700;color:var(--txt);}
.bat-d{padding:16px 0;text-align:center;font-size:24px;font-weight:900;color:#ffaa00;border-left:1px solid #2a2a2a;border-right:1px solid #2a2a2a;}
.bat-b{padding:16px 20px;font-size:18px;font-weight:700;text-align:right;color:var(--txt);}

/* ‚ïê‚ïê VR TOAST ‚ïê‚ïê */
#vr-toast{position:absolute;bottom:210px;right:38px;background:linear-gradient(135deg,#003800,#008800);padding:16px 24px;border-radius:5px;opacity:0;pointer-events:none;font-family:var(--font);}
#vr-toast.animating{animation:toastAnim 4.5s ease forwards;}
#vr-label{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#88ff88;margin-bottom:4px;}
#vr-tiempo{font-size:36px;font-weight:900;line-height:1;color:#fff;}
#vr-piloto{font-size:13px;color:#88ff88;margin-top:4px;}

/* ‚ïê‚ïê TICKER ‚ïê‚ïê */
#ticker{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.9);border-top:2px solid var(--c2);height:42px;display:flex;align-items:center;overflow:hidden;opacity:0;transition:opacity 0.4s;font-family:var(--font);}
#ticker-badge{background:var(--c1);padding:0 16px;height:100%;display:flex;align-items:center;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;white-space:nowrap;flex-shrink:0;}
#ticker-text{font-size:14px;font-weight:600;letter-spacing:1px;white-space:nowrap;animation:tickerAnim 35s linear infinite;padding-left:40px;}

/* ‚ïê‚ïê TEMAS ‚ïê‚ïê */
.theme-sport-blue{--c1:#0088ff;--c2:#004488;--c3:#002244;--accent:#ffcc00;}
.theme-neon-green{--c1:#00ff88;--c2:#006633;--c3:#003319;--accent:#ffff00;--txt3:#aaa;}
.theme-gold{--c1:#c8960c;--c2:#7a5800;--c3:#3a2800;--accent:#fff;}
.theme-white{--c1:#222;--c2:#444;--c3:#666;--bg:rgba(255,255,255,0.92);--txt:#111;--txt2:#333;--txt3:#888;--accent:#dc143c;}
</style>

<!-- Firebase SDK + PMV Bridge -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="studio-bridge.js"></script>


</head>
<body>
<div id="canvas">

  <!-- INTRO SCREEN -->
  <div id="intro-screen">
    <div id="intro-bg"></div>
    <div id="intro-hexbg"></div>
    <div id="intro-scanline"></div>
    <img id="intro-track-img" src="" alt="">
    <div id="intro-logo">PMV KARTING TV</div>
    <div id="intro-left">
      <div id="intro-badge">üèÅ <span id="ib-ronda">Ronda 1 ‚Äî 2026</span></div>
      <div id="intro-evento">PMV KARTING&#10;CHAMPIONSHIP</div>
      <div id="intro-subtitulo">Rotax Junior</div>
      <div id="intro-line"></div>
      <div id="intro-datos">
        <div class="intro-dato" style="animation-delay:1.0s"><div class="intro-dato-label">Circuito</div><div class="intro-dato-val" id="id-circuito">Kart√≥dromo PMV</div></div>
        <div class="intro-dato" style="animation-delay:1.1s"><div class="intro-dato-label">Ciudad</div><div class="intro-dato-val" id="id-ciudad">Quito, Ecuador</div></div>
        <div class="intro-dato" style="animation-delay:1.2s"><div class="intro-dato-label">Longitud</div><div class="intro-dato-val" id="id-longitud">1.200 <span class="highlight">km</span></div></div>
        <div class="intro-dato" style="animation-delay:1.3s"><div class="intro-dato-label">Curvas</div><div class="intro-dato-val" id="id-curvas">12 curvas</div></div>
        <div class="intro-dato" style="animation-delay:1.4s"><div class="intro-dato-label">Vueltas</div><div class="intro-dato-val" id="id-vueltas-intro">20 vueltas</div></div>
        <div class="intro-dato" style="animation-delay:1.5s"><div class="intro-dato-label">Temp. Pista</div><div class="intro-dato-val" id="id-temp">28¬∞C <span class="highlight">Seca</span></div></div>
      </div>
      <div id="intro-ronda"><div class="intro-ronda-num" id="ir-num">01</div><div class="intro-ronda-lbl">Ronda del<br>campeonato</div></div>
    </div>
    <div id="intro-right">
      <div class="intro-stat-pill"><div class="intro-stat-label">Pilotos en parrilla</div><div class="intro-stat-val" id="is-pilotos">18</div></div>
      <div class="intro-stat-pill"><div class="intro-stat-label">Pole Position</div><div class="intro-stat-val" id="is-pole">‚Äî</div></div>
      <div class="intro-stat-pill"><div class="intro-stat-label">VR anterior</div><div class="intro-stat-val" id="is-vr">‚Äî</div></div>
    </div>
    <div id="intro-footer">
      <span id="if-evento">PMV KARTING CHAMPIONSHIP 2026</span>
      <span style="opacity:0.3">|</span><span id="if-fecha">Quito ¬∑ Ecuador</span>
      <span style="opacity:0.3">|</span><span id="if-extra">Transmisi√≥n Oficial</span>
    </div>
  </div>

  <!-- BUG -->
  <div id="bug"><div id="bug-evento">PMV Karting Championship</div><div id="bug-tipo">FINAL</div><div id="bug-info">Ronda 1 ¬∑ Kart√≥dromo PMV</div></div>
  <!-- SESION BAR -->
  <div id="sesion-bar">
    <span><strong id="sb-tipo">Final</strong></span><span class="bsep">|</span>
    <span><strong id="sb-categoria">Rotax Junior</strong></span><span class="bsep">|</span>
    <span><strong id="sb-circuito">Kart√≥dromo PMV</strong></span><span class="bsep">|</span>
    <span>Aire <strong id="sb-aire">22¬∞C</strong></span><span class="bsep">|</span>
    <span id="sb-clima">‚òÄÔ∏è Seca</span>
  </div>
  <!-- TIMER -->
  <div id="timer-area">
    <div id="timer-vueltas"><span id="t-vuelta-label">Vuelta</span><span id="t-vuelta-num">0</span><span id="t-vuelta-sep">/</span><span id="t-vuelta-total">20</span></div>
    <div id="timer-cron"><span id="t-cron-time">00:00:00</span></div>
  </div>
  <!-- TORRE -->
  <div id="torre">
    <div id="torre-header"><span id="torre-label">Clasificaci√≥n</span><span id="torre-vueltas">V 0/20</span></div>
    <div id="torre-rows"></div>
  </div>
  <!-- LOWER THIRD -->
  <div id="lower-third"><div id="lt-inner"><div id="lt-badge">Piloto</div><div id="lt-nombre">JUAN P√âREZ üá™üá®</div><div id="lt-sub">#12 ‚Äî Team Red Racing | P3 ¬∑ 125 pts</div></div></div>
  <div id="bandera-overlay"><div id="bandera-inner"></div></div>
  <div id="mensaje-box"></div>
  <!-- FULL GRAPHIC -->
  <div id="full-graphic">
    <div id="fg-header"><span id="fg-title">PARRILLA DE SALIDA</span><span id="fg-sub">PMV Karting Championship 2026</span></div>
    <div id="fg-body"></div>
  </div>
  <!-- PODIO -->
  <div id="podio-overlay"><div id="podio-header">üèÜ PODIO FINAL</div><div id="podio-grid"></div></div>
  <!-- BATALLA -->
  <div id="batalla-box"><div id="batalla-header">‚öî BATALLA EN PISTA</div><div id="batalla-content"><div class="bat-a" id="bat-a">‚Äî</div><div class="bat-d" id="bat-delta">‚Äî</div><div class="bat-b" id="bat-b">‚Äî</div></div></div>
  <!-- VR TOAST -->
  <div id="vr-toast"><div id="vr-label">üü£ Vuelta R√°pida</div><div id="vr-tiempo">1:22.341</div><div id="vr-piloto">#7 ¬∑ Carlos L√≥pez</div></div>
  <!-- TICKER -->
  <div id="ticker"><div id="ticker-badge">PMV RACING</div><div id="ticker-text">PMV Karting Championship 2026</div></div>
</div>

<script>
function scaleCanvas(){let c=document.getElementById('canvas'),s=Math.min(window.innerWidth/1920,window.innerHeight/1080),ox=(window.innerWidth-1920*s)/2,oy=(window.innerHeight-1080*s)/2;c.style.transform=`translate(${ox}px,${oy}px) scale(${s})`;}
scaleCanvas();window.addEventListener('resize',scaleCanvas);

const ch=new BroadcastChannel('pmv-karting-gfx');
let timerMode='vueltas';

ch.onmessage=function(e){
  const{type,payload}=e.data;
  switch(type){
    case 'TEMA':             applyTheme(payload); break;
    case 'OPACIDAD':         applyOpacidad(payload); break;
    case 'SESION':           onSesion(payload); break;
    case 'SHOW_BUG':         show('bug'); break;
    case 'HIDE_ELEMENT':     hide(payload.el); break;
    case 'TOGGLE_TORRE':     payload.visible?show('torre'):hide('torre'); break;
    case 'TOGGLE_TIMER':     payload.visible?show('timer-area'):hide('timer-area'); break;
    case 'TOGGLE_SESIONBAR': payload.visible?show('sesion-bar'):hide('sesion-bar'); break;
    case 'TIMER_MODE':       setTimerMode(payload.mode); break;
    case 'VUELTA':           onVuelta(payload); break;
    case 'CRON_UPDATE':      setText('t-cron-time',payload.time); break;
    case 'TORRE':            onTorre(payload.pilotos); break;
    case 'VUELTA_RAPIDA':    onVR(payload); break;
    case 'LOWER_THIRD':      onLT(payload); break;
    case 'HIDE_LOWER_THIRD': hide('lower-third'); break;
    case 'FLAG':             onFlag(payload.color); break;
    case 'MENSAJE':          onMensaje(payload); break;
    case 'HIDE_MENSAJE':     hide('mensaje-box'); break;
    case 'FULL_GRAPHIC':     onFG(payload); break;
    case 'BATALLA':          onBatalla(payload); break;
    case 'HIDE_BATALLA':     hide('batalla-box'); break;
    case 'TICKER':           onTicker(payload); break;
    case 'INTRO':            onIntro(payload); break;
    case 'HIDE_INTRO':       hide('intro-screen'); break;
    case 'CLEAR_ALL':        clearAll(); break;
  }
};

function show(id){let e=document.getElementById(id);if(e){e.style.opacity='1';e.style.pointerEvents='all';}}
function hide(id){let e=document.getElementById(id);if(e){e.style.opacity='0';e.style.pointerEvents='none';}}
function setText(id,v){let e=document.getElementById(id);if(e)e.textContent=v;}
function clearAll(){['lower-third','bandera-overlay','mensaje-box','full-graphic','podio-overlay','batalla-box','vr-toast','ticker','intro-screen'].forEach(hide);document.getElementById('bandera-inner').className='';document.getElementById('bandera-inner').textContent='';}

/* ‚ïê‚ïê OPACIDAD ‚Äî esquina + centro ‚ïê‚ïê */
function applyOpacidad(d){
  let c=document.getElementById('canvas');
  // Esquina
  if(d.bug    !=null) c.style.setProperty('--op-bug',    d.bug/100);
  if(d.torre  !=null) c.style.setProperty('--op-torre',  d.torre/100);
  if(d.timer  !=null) c.style.setProperty('--op-timer',  d.timer/100);
  if(d.bar    !=null) c.style.setProperty('--op-bar',    d.bar/100);
  // Centro
  if(d.intro  !=null) c.style.setProperty('--op-intro',  d.intro/100);
  if(d.parrilla!=null)c.style.setProperty('--op-parrilla',d.parrilla/100);
  if(d.fullgfx!=null) c.style.setProperty('--op-parrilla',d.fullgfx/100); // alias
  if(d.podio  !=null) c.style.setProperty('--op-podio',  d.podio/100);
  if(d.mensaje!=null) c.style.setProperty('--op-mensaje', d.mensaje/100);
  if(d.batalla!=null) c.style.setProperty('--op-batalla', d.batalla/100);
}

/* ‚ïê‚ïê TEMA ‚ïê‚ïê */
function applyTheme(t){
  let canvas=document.getElementById('canvas');
  canvas.className=canvas.className.replace(/theme-\S+/g,'').trim();
  if(t.preset&&t.preset!=='custom')canvas.classList.add('theme-'+t.preset);
  if(t.font)  canvas.style.setProperty('--font',t.font);
  if(t.c1)    canvas.style.setProperty('--c1',t.c1);
  if(t.c2)    canvas.style.setProperty('--c2',t.c2);
  if(t.c3)    canvas.style.setProperty('--c3',t.c3);
  if(t.bg)    canvas.style.setProperty('--bg',t.bg);
  if(t.txt)   canvas.style.setProperty('--txt',t.txt);
  if(t.accent)canvas.style.setProperty('--accent',t.accent);
  if(t.skew!=null)canvas.style.setProperty('--skew',t.skew+'deg');
}

function setTimerMode(mode){
  timerMode=mode;
  let tv=document.getElementById('timer-vueltas'),tc=document.getElementById('timer-cron');
  if(mode==='vueltas'){tv.style.display='flex';tc.style.display='none';}
  else if(mode==='cronometro'||mode==='regresivo'){tv.style.display='none';tc.style.display='flex';}
  else if(mode==='ambos'){tv.style.display='flex';tc.style.display='flex';}
  show('timer-area');
}

function onSesion(d){
  setText('bug-evento',d.evento);setText('bug-tipo',d.tipo);setText('bug-info',d.ronda+' ¬∑ '+d.circuito);
  setText('sb-tipo',d.tipo);setText('sb-categoria',d.categoria);setText('sb-circuito',d.circuito);
  setText('sb-aire',d.tempAire);setText('sb-clima',d.clima);
  setText('torre-vueltas','V '+d.vueltaActual+'/'+d.vueltas);
  setText('t-vuelta-total',d.vueltas);setText('torre-label',d.tipo);
  if(d.timerMode)setTimerMode(d.timerMode);
}
function onVuelta(d){setText('t-vuelta-num',d.actual);setText('t-vuelta-total',d.total);setText('torre-vueltas','V '+d.actual+'/'+d.total);show('timer-area');}

function onTorre(pilotos){
  let container=document.getElementById('torre-rows');container.innerHTML='';
  pilotos.slice(0,10).forEach((p,i)=>{
    let ec=p.estado==='pit'?'e-pit':(p.estado==='out'||p.estado==='dnf')?'e-out':'';
    let rc=i===0?'row-p1':i===1?'row-p2':i===2?'row-p3':'';
    let fotoHtml=p.foto?`<img class="t-foto" src="${p.foto}" alt="" onerror="this.style.display='none'">`:`<div style="width:28px;height:28px;background:#1a1a1a;border-radius:3px;border:1px solid #222;"></div>`;
    let div=document.createElement('div');div.className='torre-row '+rc;div.style.animationDelay=(i*0.04)+'s';
    div.innerHTML=`<span class="t-pos ${ec}">${p.pos}</span><span class="t-num ${ec}">${p.num}</span>${fotoHtml}<div class="t-info"><div class="t-nombre">${p.nombre} ${p.pais||''}</div><div class="t-equipo">${p.equipo}</div></div><div class="t-right"><div class="t-gap ${ec}">${p.estado!=='pista'?p.estado.toUpperCase():p.gap}</div><div class="t-vuelta">${p.vuelta}</div></div>`;
    container.appendChild(div);
  });
  show('torre');
}

function onVR(d){setText('vr-tiempo',d.tiempo);setText('vr-piloto',d.num+' ¬∑ '+d.piloto+' (V'+d.vuelta+')');let el=document.getElementById('vr-toast');el.classList.remove('animating');void el.offsetWidth;el.classList.add('animating');}

function onLT(d){
  const badges={piloto:'üèé Piloto',entrevistado:'üéô Entrevistado',comentarista:'üé§ Comentarista',director:'üìã Dir. de Carrera',equipo:'üîß Equipo'};
  setText('lt-badge',badges[d.tipo]||d.tipo);setText('lt-nombre',d.nombre.toUpperCase()+' '+(d.pais||''));setText('lt-sub',d.sub+(d.extra?' | '+d.extra:''));show('lower-third');
  clearTimeout(window._ltTimer);window._ltTimer=setTimeout(()=>hide('lower-third'),10000);
}

const flagData={verde:{text:'üü¢  PISTA LIBRE ‚Äî VERDE',cls:'fc-verde'},'amarilla-local':{text:'üü°  PRECAUCI√ìN ‚Äî ZONA AMARILLA',cls:'fc-amarilla'},fciy:{text:'üü°üü°  FULL COURSE YELLOW',cls:'fc-fciy'},roja:{text:'üî¥  BANDERA ROJA ‚Äî CARRERA DETENIDA',cls:'fc-roja'},safety:{text:'üöó  SAFETY KART EN PISTA',cls:'fc-safety'},chequered:{text:'üèÅ  BANDERA A CUADROS ‚Äî FIN DE CARRERA',cls:'fc-chequered'},clear:{text:'',cls:''}};
function onFlag(color){let f=flagData[color]||flagData.clear;let inner=document.getElementById('bandera-inner');inner.textContent=f.text;inner.className=f.cls;if(color==='clear'){hide('bandera-overlay');return;}show('bandera-overlay');if(color!=='roja'&&color!=='fciy'){clearTimeout(window._flagTimer);window._flagTimer=setTimeout(()=>hide('bandera-overlay'),6000);}}

function onMensaje(d){
  let el=document.getElementById('mensaje-box');
  let op=parseFloat(getComputedStyle(document.getElementById('canvas')).getPropertyValue('--op-mensaje'))||0.93;
  el.textContent=d.texto;
  let cls='mc-'+d.tipo;
  // Aplicar fondo con opacidad actual
  const bgMap={info:`rgba(0,50,160,${op})`,warning:`rgba(160,110,0,${op})`,penalty:`rgba(150,0,0,${op})`,safety:`rgba(0,55,150,${op})`};
  el.className=cls;
  el.style.background=bgMap[d.tipo]||bgMap.info;
  if(d.tipo==='warning')el.style.color='#000'; else el.style.color='';
  show('mensaje-box');
  clearTimeout(window._msgTimer);window._msgTimer=setTimeout(()=>hide('mensaje-box'),d.duracion||8000);
}

function onIntro(d){
  setText('ib-ronda',d.ronda||'Ronda 1 ‚Äî 2026');
  let ev=document.getElementById('intro-evento');if(ev)ev.textContent=(d.evento||'PMV KARTING\nCHAMPIONSHIP').toUpperCase();
  setText('intro-subtitulo',d.categoria||'Rotax Junior');
  setText('id-circuito',d.circuito||'‚Äî');setText('id-ciudad',d.ciudad||'‚Äî');
  setText('id-longitud',d.longitud||'‚Äî');setText('id-curvas',d.curvas||'‚Äî');
  setText('id-vueltas-intro',d.vueltas||'‚Äî');setText('id-temp',(d.tempPista||'‚Äî')+' '+(d.clima||''));
  setText('ir-num',String(d.numRonda||'01').padStart(2,'0'));
  setText('is-pilotos',d.numPilotos||'‚Äî');setText('is-pole',d.pole||'‚Äî');setText('is-vr',d.vrAnterior||'‚Äî');
  setText('if-evento',(d.evento||'PMV KARTING CHAMPIONSHIP').toUpperCase());
  setText('if-fecha',d.ciudad||'‚Äî');setText('if-extra',d.extra||'Transmisi√≥n Oficial');
  let img=document.getElementById('intro-track-img');
  if(d.trackImg){img.src=d.trackImg;img.style.opacity='0.38';}else{img.src='';img.style.opacity='0';}
  show('intro-screen');
  if(d.autohide){clearTimeout(window._introTimer);window._introTimer=setTimeout(()=>hide('intro-screen'),d.autohide*1000);}
}

function onFG(payload){
  let tipo=payload.tipo;
  hide('full-graphic');hide('podio-overlay');
  if(tipo==='hide')return;
  if(tipo==='podio'){onPodio(payload.pilotos||[]);return;}
  if(tipo==='parrilla'){onParrillaF1(payload.pilotos||[]);return;}
  const titles={resultados:'üèÜ Resultado Final',clasificacion:'üìä Clasificaci√≥n','campeonato-tabla':'üìã Campeonato ‚Äî Puntos'};
  setText('fg-title',titles[tipo]||tipo.toUpperCase());
  let body=document.getElementById('fg-body'),pilotos=payload.pilotos||[];
  if(tipo==='campeonato-tabla'){
    body.innerHTML=`<table class="fg-table"><tr><th>Pos</th><th>Piloto</th><th>Equipo</th><th>Puntos</th><th>Dif.</th><th>VR</th></tr>${pilotos.map((p,i)=>`<tr><td class="fg-pos">${i+1}</td><td>${p.nombre}</td><td style="color:#666;font-size:15px;">${p.equipo}</td><td class="fg-pts">${p.pts}</td><td style="color:#666;">${p.dif}</td><td style="color:#cc44cc;">${p.vr}</td></tr>`).join('')}</table>`;
  } else {
    body.innerHTML=`<table class="fg-table"><tr><th>Pos</th><th>N¬∫</th><th>Foto</th><th></th><th>Piloto</th><th>Equipo</th><th>Mejor V.</th><th>Gap</th></tr>${pilotos.map((p,i)=>`<tr><td class="fg-pos">${p.pos||i+1}</td><td class="fg-num">${p.num}</td><td>${p.foto?`<img class="fg-foto" src="${p.foto}" onerror="this.style.display='none'">`:''}</td><td class="fg-pais">${p.pais||''}</td><td>${p.nombre}</td><td style="color:#666;font-size:15px;">${p.equipo}</td><td style="color:#ccc;">${p.vuelta||'‚Äî'}</td><td class="fg-gap">${p.gap||'‚Äî'}</td></tr>`).join('')}</table>`;
  }
  show('full-graphic');
  clearTimeout(window._fgTimer);
  if(tipo!=='resultados'&&tipo!=='campeonato-tabla')window._fgTimer=setTimeout(()=>hide('full-graphic'),18000);
}

function onParrillaF1(pilotos){
  setText('fg-title','üèé  PARRILLA DE SALIDA');
  let body=document.getElementById('fg-body');
  let maxP=Math.min(pilotos.length,20),leftCol='',rightCol='';
  for(let i=0;i<maxP;i++){
    let p=pilotos[i],pos=p.pos||i+1,isLeft=(parseInt(pos)%2===1),isP1=parseInt(pos)===1,delay=(i*0.06).toFixed(2),sideClass=isLeft?'':'right-side',p1Class=isP1?'gs-p1':'';
    let fotoHtml=p.foto?`<img class="gs-foto" src="${p.foto}" onerror="this.className='gs-foto-placeholder'">`:`<div class="gs-foto-placeholder"></div>`;
    let slot=`<div class="grid-slot ${sideClass} ${p1Class}" style="animation-delay:${delay}s"><div class="gs-pos-block"><div class="gs-pos-num">${pos}</div><div class="gs-pos-lbl">POS</div></div><div class="gs-body">${isLeft?fotoHtml:''}<div class="gs-info"><div class="gs-nombre">${p.nombre}</div><div class="gs-equipo">${p.equipo}</div></div><div class="gs-pais">${p.pais||''}</div><div class="gs-num-badge">${p.num}</div><div class="gs-quali"><div class="gs-quali-time">${p.vuelta||'‚Äî'}</div><div class="gs-quali-lbl">Quali</div></div>${!isLeft?fotoHtml:''}</div></div>`;
    isLeft?leftCol+=slot:rightCol+=slot;
  }
  body.innerHTML=`<div id="grid-f1-wrap"><div class="grid-f1-title">‚¨õ FILA INTERIOR &nbsp;&nbsp;&nbsp; ‚¨ú FILA EXTERIOR</div><div class="grid-f1-track"><div id="gf-left">${leftCol}</div><div id="gf-right" style="margin-top:36px;">${rightCol}</div></div></div>`;
  show('full-graphic');clearTimeout(window._fgTimer);window._fgTimer=setTimeout(()=>hide('full-graphic'),20000);
}

function onPodio(pilotos){
  while(pilotos.length<3)pilotos.push({nombre:'‚Äî',equipo:'‚Äî',vuelta:'‚Äî',foto:''});
  let g=document.getElementById('podio-grid');
  let card=(p,cls,pos,delay)=>`<div class="podio-card ${cls}" style="animation-delay:${delay}s">${p.foto?`<img class="podio-foto" src="${p.foto}" onerror="this.style.display='none'">`:''}<div class="podio-num-pos" style="color:${pos===1?'#FFD700':pos===2?'#C0C0C0':'#CD7F32'}">${pos}</div><div class="podio-nombre">${p.nombre}</div><div class="podio-equipo">${p.equipo}</div><div class="podio-tiempo">${p.vuelta}</div></div>`;
  g.innerHTML=card(pilotos[1],'p2',2,0.1)+card(pilotos[0],'p1',1,0)+card(pilotos[2],'p3',3,0.2);
  show('podio-overlay');
}

function onBatalla(d){setText('bat-a',d.pilotoA);setText('bat-b',d.pilotoB);setText('bat-delta',d.delta);show('batalla-box');clearTimeout(window._batTimer);window._batTimer=setTimeout(()=>hide('batalla-box'),14000);}
function onTicker(d){if(d.active){setText('ticker-text',d.texto);show('ticker');}else hide('ticker');}

show('bug');show('sesion-bar');show('timer-area');
</script>
</body>
</html>